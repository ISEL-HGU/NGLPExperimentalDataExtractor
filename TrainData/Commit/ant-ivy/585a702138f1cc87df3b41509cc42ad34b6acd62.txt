        ConflictManager conflictManager = null;
        for (VisitNode current : ancestor.getPath()) {
            ModuleDescriptor descriptor = current.getNode().getDescriptor();
            if (descriptor == null) {
                throw new IllegalStateException(
                        "impossible to get conflict manager when data has not been loaded. IvyNode = "
                                 current.getNode());
            }

            conflictManager = descriptor.getConflictManager(node.getModuleId());
            if (conflictManager != null) {
                break;
            }
        }

        if (conflictManager == null) {
            conflictManager = settings.getConflictManager(node.getModuleId());
        }
