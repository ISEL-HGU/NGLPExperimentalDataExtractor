import java.util.List;
import java.util.Optional;
import org.apache.camel.Service;

            // a bit of ugly code to handover pre registered services that has been add to an eager/provisional JmxManagementLifecycleStrategy
            // which is now re-placed with a new JmxManagementLifecycleStrategy that is based on the end user configured settings
            // and therefore will be in use
            List<JmxManagementLifecycleStrategy.PreRegisterService> preServices = null;
            JmxManagementLifecycleStrategy jmx = camelContext.getLifecycleStrategies().stream()
                    .filter(s -> s instanceof JmxManagementLifecycleStrategy)
                    .map(JmxManagementLifecycleStrategy.class::cast)
                    .findFirst().orElse(null);
            if (jmx != null) {
                preServices = jmx.getPreServices();
            }

            if (preServices != null &&  !preServices.isEmpty() && lifecycle instanceof JmxManagementLifecycleStrategy) {
                JmxManagementLifecycleStrategy existing = (JmxManagementLifecycleStrategy) lifecycle;
                for (JmxManagementLifecycleStrategy.PreRegisterService pre : preServices) {
                    existing.addPreService(pre);
                }
            }

