import java.io.BufferedInputStream;
import org.apache.camel.InvalidPayloadException;
import org.apache.camel.TypeConverter;
import org.apache.camel.support.InputStreamIterator;
        Object body = exchange.getIn().getBody();
        TypeConverter converter = exchange.getContext().getTypeConverter();
        // favour using input stream
        InputStream is = converter.tryConvertTo(InputStream.class, exchange, body);
        if (is == null) {
            // okay so try to see if its an iterator which we can wrap as input stream
            Iterator it = converter.tryConvertTo(Iterator.class, exchange, body);
            if (it != null) {
                is = new InputStreamIterator(converter, it);
                is = new BufferedInputStream(is);
            }
        }
        if (is == null) {
            throw new InvalidPayloadException(exchange, body.getClass());
        }
