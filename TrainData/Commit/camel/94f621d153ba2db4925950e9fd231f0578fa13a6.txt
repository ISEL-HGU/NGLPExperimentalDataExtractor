import static org.apache.camel.util.ExchangeHelper.convertToMandatoryType;
import static org.apache.camel.util.ExchangeHelper.convertToType;

import com.univocity.parsers.common.AbstractWriter;
            synchronized (headers) {
                for (Object key : map.keySet()) {
                    headers.add(convertToMandatoryType(exchange, String.class, key));
                }
                writeRow(map, writer);
        } else {
            writeRow(map, writer);
    }
    /**
     * Writes the given map as row.
     * 
     * @param map row values by header
     * @param writer uniVocity writer to use
     */
    private void writeRow(Map<?, ?> map, W writer) {
      Object[] values = new Object[headers.size()];
      int index = 0;
      for (String header : headers) {
          values[index] = map.get(header);
      }
      writer.writeRow(values);
