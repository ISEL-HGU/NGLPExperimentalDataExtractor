import javax.xml.soap.MimeHeaders;
import javax.xml.soap.SOAPMessage;
import org.springframework.ws.soap.saaj.SaajSoapMessage;
        
        // populate camel exchange with breadcrumb from transport header        
        populateExchangeWithBreadcrumbFromMessageContext(messageContext, exchange);
        
    
    private void populateExchangeWithBreadcrumbFromMessageContext(MessageContext messageContext, Exchange exchange) {
        SaajSoapMessage saajSoap = (SaajSoapMessage) messageContext.getRequest();
        SOAPMessage soapMesssageRequest = null;
        if (saajSoap != null) {
            soapMesssageRequest = saajSoap.getSaajMessage();
            if (soapMesssageRequest != null) {
                MimeHeaders mimeHeaders = soapMesssageRequest.getMimeHeaders();
                if (mimeHeaders != null) {
                    String[] breadcrumbIdHeaderValues = mimeHeaders.getHeader(Exchange.BREADCRUMB_ID);
                    // expected to get one token
                    // if more than one token expected, 
                    // presumably breadcrumb generation strategy 
                    // may be required to implement
                    if (breadcrumbIdHeaderValues != null && breadcrumbIdHeaderValues.length >= 1) {
                        exchange.getIn().setHeader(Exchange.BREADCRUMB_ID, breadcrumbIdHeaderValues[0]);
                    }
                }
            }
        }
    }
