import org.apache.camel.CamelContext;
            if (camelController instanceof LocalCamelController) {
                executeLocal((LocalCamelController) camelController, camelContextName, routeId, out, err);
            } else {
                executeOnRoute(camelController, camelContextName, routeId, out, err);
            }
    private void executeLocal(LocalCamelController camelController, String camelContextName, String routeId, PrintStream out, PrintStream err) throws Exception {
        CamelContext camelContext = camelController.getLocalCamelContext(context);
        if (camelContext == null) {
            err.println("Camel context "  context  " not found.");
            return;
        }

        // Setting thread context classloader to the bundle classloader to enable legacy code that relies on it
        ClassLoader oldClassloader = Thread.currentThread().getContextClassLoader();
        ClassLoader applicationContextClassLoader = camelContext.getApplicationContextClassLoader();
        if (applicationContextClassLoader  != null) {
            Thread.currentThread().setContextClassLoader(applicationContextClassLoader);
        }
        try {
            executeOnRoute(camelController, camelContextName, routeId, out, err);
        } finally {
            Thread.currentThread().setContextClassLoader(oldClassloader);
        }
    }

