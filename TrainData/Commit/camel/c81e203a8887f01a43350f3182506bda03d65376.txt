        connection = getEndpoint().getNatsConfiguration().getConnection() != null ? 
            getEndpoint().getNatsConfiguration().getConnection():getEndpoint().getConnection();
        if (ObjectHelper.isEmpty(getEndpoint().getNatsConfiguration().getConnection())) {
            LOG.debug("Closing Nats Connection");
            if (connection != null && !connection.getStatus().equals(Status.CLOSED)) {
                if (getEndpoint().getNatsConfiguration().isFlushConnection()) {
                    LOG.debug("Flushing Nats Connection");
                    connection.flush(Duration.ofMillis(getEndpoint().getNatsConfiguration().getFlushTimeout()));
                }
                connection.close();
        super.doStop();
