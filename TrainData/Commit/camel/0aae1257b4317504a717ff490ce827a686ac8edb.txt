import java.util.Map;

import org.apache.camel.impl.cloud.BlacklistServiceFilter;
import org.apache.camel.impl.cloud.ChainedServiceFilter;
import org.apache.camel.util.StringHelper;
    @Bean(name = "service-filter-chained")
    public ServiceFilter chainedServiceFilter(ServiceCallConfigurationProperties properties) {
        BlacklistServiceFilter blacklist = new BlacklistServiceFilter();
        Map<String, String> services = properties.getServiceFilter().getBlacklist();
        for (Map.Entry<String, String> entry : services.entrySet()) {

            String[] parts = entry.getValue().split(",");
            for (String part : parts) {
                String host = StringHelper.before(part, ":");
                String port = StringHelper.after(part, ":");

                blacklist.addServer(entry.getKey(), host, Integer.parseInt(port));
            }
        }

        return ChainedServiceFilter.wrap(new HealthyServiceFilter(), blacklist);
