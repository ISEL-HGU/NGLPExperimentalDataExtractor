        int squareBracketCnt = 0; // special to keep track if and how deep we are inside a square bracket block, eg: [foo]
        int parenthesisBracketCnt = 0; // special to keep track if and how deep we are inside a parenthesis block, eg: bar(${body}, ${header.foo})

                if (ch == '[' && parenthesisBracketCnt == 0) {
                    squareBracketCnt;
                    parenthesisBracketCnt;
                    parenthesisBracketCnt--;
                if (ch == '.' && squareBracketCnt == 0 && parenthesisBracketCnt == 0) {
                } else if (ch == ']' && parenthesisBracketCnt == 0) {
                    squareBracketCnt--;
                if (ch != ']' || parenthesisBracketCnt > 0) {
        if (parenthesisBracketCnt>0 && last != null) {
