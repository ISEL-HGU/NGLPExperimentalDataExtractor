import org.apache.camel.opentracing.concurrent.CamelSpanManager;
import org.apache.camel.opentracing.concurrent.OpenTracingExecutorServiceManager;
    private static final String MANAGED_SPAN_PROPERTY = "ManagedSpan";

    private final CamelSpanManager spanManager = CamelSpanManager.getInstance();

                // Wrap the ExecutorServiceManager with a SpanManager aware version
                camelContext.setExecutorServiceManager(
                        new OpenTracingExecutorServiceManager(camelContext.getExecutorServiceManager(), spanManager));
                ese.getExchange().setProperty(MANAGED_SPAN_PROPERTY, spanManager.activate(span));
                spanManager.clear();
                ExchangeSentEvent ese = (ExchangeSentEvent) event;
                SpanManager.ManagedSpan managedSpan = (SpanManager.ManagedSpan)
                        ese.getExchange().getProperty(MANAGED_SPAN_PROPERTY);
                if (managedSpan != null) {
                    spanManager.activate(managedSpan);
                    ese.getExchange().setProperty(MANAGED_SPAN_PROPERTY, null);
                } else {
                    managedSpan = spanManager.current();
                }
                SpanDecorator sd = getSpanDecorator(ese.getEndpoint());
                sd.post(managedSpan.getSpan(), ese.getExchange(), ese.getEndpoint());
            // Check if continuing exchange on same thread
            if (exchange.getProperties().containsKey(MANAGED_SPAN_PROPERTY)) {
                spanManager.activate((SpanManager.ManagedSpan)exchange.getProperty(MANAGED_SPAN_PROPERTY));
                exchange.setProperty(MANAGED_SPAN_PROPERTY, null);
            }
            if (managedSpan.getSpan() != null) {
                if (LOG.isTraceEnabled()) {
                    LOG.trace("OpenTracing: finish server span="  managedSpan.getSpan());
                }
                SpanDecorator sd = getSpanDecorator(route.getEndpoint());
                sd.post(managedSpan.getSpan(), exchange, route.getEndpoint());
                managedSpan.getSpan().finish();
                managedSpan.deactivate();
            } else {
                LOG.warn("OpenTracing: could not find managed span for exchange="  exchange);
