                    // avoid setting a handler more than once
                    if (!isHandlerInChain(server.getHandler(), handler)) {

    protected boolean isHandlerInChain(Handler current, Handler handler) {
    	
    	if (handler.equals(current)) {
    		//Found a match in the chain
    		return true;
    	} else if (current instanceof HandlerWrapper) {
    		//Inspect the next handler in the chain
    		return isHandlerInChain(((HandlerWrapper) current).getHandler(), handler);
    	} else {
    		//End of chain
    		return false;
    	}
    	
    }
