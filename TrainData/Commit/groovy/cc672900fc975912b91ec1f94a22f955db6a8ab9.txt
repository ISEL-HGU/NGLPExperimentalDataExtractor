                ClassNode classNode = controller.getClassNode();
                boolean isThisOrSuper = false;
                if (receiver instanceof VariableExpression) {
                    isThisOrSuper = ((VariableExpression) receiver).isThisExpression() || ((VariableExpression) receiver).isSuperExpression();
                }
                Expression fixedReceiver = null;
                if (isThisOrSuper && classNode instanceof InnerClassNode && controller.isInClosure()) {
                    ClassNode current = classNode.getOuterClass();
                    fixedReceiver = new VariableExpression("thisObject", current);
                    // adjust for multiple levels of nesting if needed
                    while (current instanceof InnerClassNode && !classNode.equals(current)) {
                        FieldNode thisField = current.getField("this$0");
                        current = current.getOuterClass();
                        if (thisField != null) {
                            fixedReceiver = new PropertyExpression(fixedReceiver, "this$0");
                            fixedReceiver.setType(current);
                        }
                    }
                }

                argumentList.add(0, fixedReceiver != null ? fixedReceiver : receiver);
