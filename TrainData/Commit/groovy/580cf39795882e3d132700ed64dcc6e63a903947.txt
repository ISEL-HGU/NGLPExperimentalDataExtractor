import java.security.AccessController;
import java.security.PrivilegedAction;

        // Classloaders should only be created inside doPrivileged block
        // This code creates a classloader, which needs permission if a security manage is installed.
        // If this code might be invoked by code that does not have security permissions, then the classloader creation needs to occur inside a doPrivileged block.
        this.classLoader = (GroovyClassLoader) AccessController.doPrivileged(new PrivilegedAction() {
            public Object run() {
                ClassLoader parent = Thread.currentThread().getContextClassLoader();
                if (parent == null) parent = ProcessingUnit.class.getClassLoader();
                return loader == null ? new GroovyClassLoader(parent, configuration) : loader;
            }
        });
