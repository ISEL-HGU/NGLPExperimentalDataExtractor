import org.apache.cayenne.map.SQLResult;
import org.apache.cayenne.testdo.testmap.Artist;
import static org.hamcrest.CoreMatchers.instanceOf;
	public void testExceptionWhenUsingColumnsTypesAndSQLResult(){
		SQLTemplate query = new SQLTemplate("SELECT ARTIST_ID P FROM ARTIST", true);
		query.setResultColumnsTypes(Float.class);
		SQLResult resultDescriptor = new SQLResult();
		resultDescriptor.addColumnResult("P");
		query.setResult(resultDescriptor);
		context.performQuery(query);
	}

	@Test(expected = CayenneRuntimeException.class)
	public void testExceptionWhenUsingColumnsTypesAndSQLResultUsingScalar() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate query = new SQLTemplate(testDataMap, "SELECT ARTIST_ID, ARTIST_NAME P FROM ARTIST", false);
		query.setResultColumnsTypes(Float.class, String.class);
		query.setUseScalar(true);
		SQLResult resultDescriptor = new SQLResult();
		resultDescriptor.addColumnResult("P");
		resultDescriptor.addColumnResult("N");
		query.setResult(resultDescriptor);
		context.performQuery(query);
	}

	@Test
	public void testWithRootUsingScalar() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		String sql1 = "INSERT INTO ARTIST VALUES (16, 'Ivanov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q2 = new SQLTemplate(testDataMap, sql1, true);
		context.performNonSelectingQuery(q2);
		SQLTemplate q3 = new SQLTemplate(Artist.class, "SELECT ARTIST_ID, ARTIST_NAME FROM ARTIST");
		q3.setResultColumnsTypes(Double.class, String.class);
		q3.setUseScalar(true);
		List<Object[]> result = context.performQuery(q3);
		assertEquals(2, result.size());
		assertTrue(result.get(0) instanceof Object[]);
		assertTrue(result.get(0)[0] instanceof Double);
	}

	@Test
	public void testWithRootUsingDataRow() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		String sql1 = "INSERT INTO ARTIST VALUES (16, 'Ivanov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q2 = new SQLTemplate(testDataMap, sql1, true);
		context.performNonSelectingQuery(q2);
		SQLTemplate q3 = new SQLTemplate(Artist.class, "SELECT ARTIST_ID, ARTIST_NAME FROM ARTIST");
		q3.setResultColumnsTypes(Double.class, String.class);
		q3.setFetchingDataRows(true);
		q3.setColumnNamesCapitalization(CapsStrategy.UPPER);
		List<DataRow> result = context.performQuery(q3);
		assertEquals(2, result.size());
		assertTrue(result.get(0) instanceof DataRow);
		assertThat(result.get(0).get("ARTIST_ID"), instanceOf(Double.class));
	}

	@Test(expected = CayenneRuntimeException.class)
	public void testWithRootException() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q3 = new SQLTemplate(Artist.class, "SELECT ARTIST_ID, ARTIST_NAME FROM ARTIST");
		q3.setResultColumnsTypes(Double.class, String.class);
		context.performQuery(q3);
	}

	@Test(expected = CayenneRuntimeException.class)
	public void testUsingScalarAndDataRow() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q3 = new SQLTemplate(Artist.class, "SELECT ARTIST_ID, ARTIST_NAME FROM ARTIST");
		q3.setUseScalar(true);
		q3.setFetchingDataRows(true);
	public void testDataRowWithTypes() {
		SQLTemplate q3 = new SQLTemplate(testDataMap, "SELECT ARTIST_ID, ARTIST_NAME FROM ARTIST", true);
		q3.setResultColumnsTypes(Double.class, String.class);
		q3.setColumnNamesCapitalization(CapsStrategy.UPPER);
		List<DataRow> artists = context.performQuery(q3);
		assertTrue(artists.get(0) instanceof DataRow);
		assertThat(artists.get(0).get("ARTIST_ID"), instanceOf(Double.class));
	public void testDataRowReturnAndDirectives() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		String sql1 = "INSERT INTO ARTIST VALUES (16, 'Ivanov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q2 = new SQLTemplate(testDataMap, sql1, true);
		context.performNonSelectingQuery(q2);

		SQLTemplate q3 = new SQLTemplate(testDataMap, "SELECT #result('ARTIST_ID' 'java.lang.Long'), #result('ARTIST_NAME' 'java.lang.String') FROM ARTIST", true);
		List<DataRow> result = context.performQuery(q3);
		assertEquals(2, result.size());
		assertTrue(result.get(0) instanceof DataRow);
		assertEquals(2, result.get(0).size());
		assertTrue(result.get(0).get("ARTIST_ID") instanceof Long);
		assertTrue(result.get(0).get("ARTIST_NAME") instanceof String);
	}

	@Test(expected = CayenneRuntimeException.class)
	public void testDataRowReturnAndDirectivesExc() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q3 = new SQLTemplate(testDataMap, "SELECT #result('ARTIST_ID' 'java.lang.Long'), #result('ARTIST_NAME' 'java.lang.String') FROM ARTIST", true);
		q3.setResultColumnsTypes(Integer.class, String.class);
		context.performQuery(q3);
	}

	@Test
	public void testObjectArrayReturnAndDirectives() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		String sql1 = "INSERT INTO ARTIST VALUES (16, 'Ivanov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q2 = new SQLTemplate(testDataMap, sql1, true);
		context.performNonSelectingQuery(q2);

		SQLTemplate q3 = new SQLTemplate(testDataMap, "SELECT #result('ARTIST_ID' 'java.lang.Long'), #result('ARTIST_NAME' 'java.lang.String') FROM ARTIST", false);
		q3.setUseScalar(true);
		List<Object[]> result = context.performQuery(q3);
		assertEquals(2, result.size());
		assertTrue(result.get(0) instanceof Object[]);
		assertEquals(2, result.get(0).length);
		assertTrue(result.get(0)[0] instanceof Long);
		assertTrue(result.get(0)[1] instanceof String);
	}

	@Test(expected = CayenneRuntimeException.class)
	public void testObjectArrayReturnAndDirectivesException() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		String sql1 = "INSERT INTO ARTIST VALUES (16, 'Ivanov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q2 = new SQLTemplate(testDataMap, sql1, true);
		context.performNonSelectingQuery(q2);

		SQLTemplate q3 = new SQLTemplate(testDataMap, "SELECT #result('ARTIST_ID' 'java.lang.Long'), #result('ARTIST_NAME' 'java.lang.String') FROM ARTIST", false);
		q3.setResultColumnsTypes(Integer.class, String.class);
		q3.setUseScalar(true);
		context.performQuery(q3);
	}

	@Test
	public void testObjectArrayWithSingleObjectReturnAndDirectives() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		String sql1 = "INSERT INTO ARTIST VALUES (16, 'Ivanov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q2 = new SQLTemplate(testDataMap, sql1, true);
		context.performNonSelectingQuery(q2);

		SQLTemplate q3 = new SQLTemplate(testDataMap, "SELECT #result('ARTIST_ID' 'java.lang.Long') FROM ARTIST", false);
		q3.setUseScalar(true);
		List<Object[]> result = context.performQuery(q3);
		assertEquals(2, result.size());
		assertTrue(result.get(0) instanceof Object[]);
		assertEquals(1, result.get(0).length);
		assertTrue(result.get(0)[0] instanceof Long);
	}

	@Test(expected = CayenneRuntimeException.class)
	public void testObjectArrayReturnWithException() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q3 = new SQLTemplate(testDataMap, "SELECT ARTIST_ID, ARTIST_NAME FROM ARTIST", false);
		q3.setResultColumnsTypes(Integer.class);
		q3.setUseScalar(true);
		context.performQuery(q3);
	}

	@Test
	public void testObjectArrayWithSingleObjectReturn() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		String sql1 = "INSERT INTO ARTIST VALUES (16, 'Ivanov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q2 = new SQLTemplate(testDataMap, sql1, true);
		context.performNonSelectingQuery(q2);

		SQLTemplate q3 = new SQLTemplate(testDataMap, "SELECT ARTIST_ID FROM ARTIST", false);
		q3.setUseScalar(true);
		List<Object[]> artists = context.performQuery(q3);
		assertEquals(2, artists.size());
		assertEquals(1, artists.get(0).length);
		assertTrue(artists.get(0) instanceof Object[]);
		assertTrue(artists.get(0)[0] instanceof Long);
	}

	@Test
	public void testObjectArrayReturnWithDefaultTypes() {
		DataMap testDataMap = context.getEntityResolver().getDataMap("testmap");
		String sql = "INSERT INTO ARTIST VALUES (15, 'Surikov', null)";
		String sql1 = "INSERT INTO ARTIST VALUES (16, 'Ivanov', null)";
		SQLTemplate q1 = new SQLTemplate(testDataMap, sql, true);
		context.performNonSelectingQuery(q1);
		SQLTemplate q2 = new SQLTemplate(testDataMap, sql1, true);
		context.performNonSelectingQuery(q2);

		SQLTemplate q3 = new SQLTemplate(testDataMap, "SELECT ARTIST_ID, ARTIST_NAME FROM ARTIST", false);
		q3.setUseScalar(true);
		List<Object[]> artists = context.performQuery(q3);
		assertEquals(2, artists.size());
		assertEquals(2, artists.get(0).length);
		assertTrue(artists.get(0) instanceof Object[]);
		assertTrue(artists.get(0)[0] instanceof Long);
	}

	@Test
	public void testObjectArrayReturn() throws SQLException {
		SQLTemplate q5 = new SQLTemplate(testDataMap, "SELECT * FROM ARTIST_CT", false);
		q5.setResultColumnsTypes(Float.class, String.class, LocalDateTime.class);
		q5.setUseScalar(true);
		SQLTemplate q5 = new SQLTemplate(testDataMap, "SELECT ARTIST_NAME FROM ARTIST_CT", false);
		q5.setResultColumnsTypes(String.class);
		q5.setUseScalar(true);
