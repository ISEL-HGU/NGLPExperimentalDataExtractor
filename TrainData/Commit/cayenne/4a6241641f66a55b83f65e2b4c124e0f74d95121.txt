import org.apache.cayenne.ObjectContext;

    @Test
    public void testSelectFromNestedContext() throws Exception {
        tArtist.insert(1, "a1");
        tArtist.insert(2, "a2");

        tPainting.insert(1, 2, "title1");
        tPainting.insert(2, 1, "title2");
        tPainting.insert(3, 1, "title3");

        ObjectContext nested = runtime.newContext(context);

        EJBQLQuery query = new EJBQLQuery("SELECT a, COUNT(a.paintingArray) FROM Artist a GROUP BY a");
        List<Object[]> result = nested.performQuery(query);
        assertEquals(2, result.size());
        for(Object[] next : result) {
            assertTrue(next[0] instanceof Artist);
            assertTrue(next[1] instanceof Number);
        }

    }
