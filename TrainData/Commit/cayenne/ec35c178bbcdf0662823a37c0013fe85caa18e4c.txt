import org.apache.cayenne.query.ObjectSelect;

    @Test
    public void testTransientInsertAndDeleteOfToManyRelationship() throws Exception {
        createArtistWithPaintingDataSet();

        Artist artist = ObjectSelect.query(Artist.class).selectOne(context);

        // create and then immediately delete a to-many relationship value
        Painting object2 = context.newObject(Painting.class);
        artist.addToPaintingArray(object2);
        artist.removeFromPaintingArray(object2);
        context.deleteObject(object2);
        assertEquals(1, artist.getPaintingArray().size());

        artist.setArtistName("updated artist name"); // this will force the commit to actually execute some SQL
        context.commitChanges();
    }
