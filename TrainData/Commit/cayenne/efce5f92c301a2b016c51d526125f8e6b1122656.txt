import org.apache.cayenne.crypto.db.Table8;
import org.apache.cayenne.query.ObjectSelect;
    
    @Test
    public void test_SelectQueryWithOptimisticLocking() throws SQLException {
        ObjectContext context = runtime.newContext();
        
        StringBuilder builder = new StringBuilder();
        for (int i = 1; i <= 10; i) {
            builder.append("ABCDEFGHIJKLMNOPQRSTUVWXYZ");
        }
        
        String str = builder.toString();
        
        Table8 t1 = context.newObject(Table8.class);
        t1.setCryptoString(str);
        context.commitChanges();

        ObjectSelect<Table8> select = ObjectSelect.query(Table8.class);
        List<Table8> result = context.select(select);
        assertEquals(str, result.get(0).getCryptoString());
        
        t1.setCryptoString(str  "A");
        context.commitChanges(); // the update should execute without any locking in the WHERE clause
        
        result = context.select(select);
        assertEquals(str"A", result.get(0).getCryptoString());
    }
