import org.apache.cayenne.CayenneException;
            try {
                ClassGenerationAction generator = newGenerator();
                generator.setArtifactsGenerationMode(mode);
                generator.setDataMap(map);
                LinkedList<ObjEntity> objEntities = new LinkedList<>(map.getObjEntities());
                objEntities.retainAll(selectedEntities);
                generator.addEntities(objEntities);
                LinkedList<Embeddable> embeddables = new LinkedList<>(map.getEmbeddables());
                embeddables.retainAll(getParentController().getSelectedEmbeddables());
                generator.addEmbeddables(embeddables);
                generator.addQueries(map.getQueryDescriptors());
                Preferences preferences = application.getPreferencesNode(GeneralPreferences.class, "");
                if (preferences != null) {
                    generator.setEncoding(preferences.get(GeneralPreferences.ENCODING_PREFERENCE, null));
                generator.setDestDir(outputDir);
                generator.setMakePairs(true);

                for (StandardPanelComponent dataMapLine : dataMapLines) {
                    if (dataMapLine.getDataMap() == map && !Util.isEmptyString(dataMapLine.getSuperclassPackage().getText())) {
                        generator.setSuperPkg(dataMapLine.getSuperclassPackage().getText());
                        break;
                    }
                }

                generators.add(generator);
            } catch (CayenneException exception) {
                JOptionPane.showMessageDialog(this.getView(), exception.getUnlabeledMessage());
                return null;
            }
