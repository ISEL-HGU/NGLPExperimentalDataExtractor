import java.lang.reflect.Method;
import org.apache.deltaspike.data.api.QueryInvocationException;
        private Method getResultStreamMethod;
        
        public StreamQueryProcessor()
        {
            try
            {
                getResultStreamMethod = Query.class.getMethod("getResultStream");
            }
            catch (Exception e)
            {
                // ignore
            }
        }
        
            if (getResultStreamMethod != null)
            {
                try
                {
                    // delegate to JPA 2.2, which is probably optimized and fetches the data lazy
                    return getResultStreamMethod.invoke(query);
                }
                catch (Exception e)
                {
                    throw new QueryInvocationException(e, context);
                }
            }
            
