import java.util.Collection;
import org.apache.guacamole.auth.ldap.ObjectQueryService;
     * Service for executing LDAP queries.
    @Inject
    private ObjectQueryService queryService;
        // Retrieve all visible user objects
        Collection<String> attributes = confService.getUsernameAttributes();
        List<LDAPEntry> results = queryService.search(ldapConnection,
                confService.getUserBaseDN(),
                confService.getUserSearchFilter(),
                attributes,
                null);
        // Convert retrieved users to map of identifier to Guacamole user object
        return queryService.asMap(results, entry -> {

            // Get username from record
            String username = queryService.getIdentifier(entry, attributes);
            if (username == null) {
                logger.warn("User \"{}\" is missing a username attribute "
                         "and will be ignored.", entry.getDN());
                return null;
            return new SimpleUser(username);
        });
        // Retrieve user objects having a matching username
        List<LDAPEntry> results = queryService.search(ldapConnection,
                confService.getUserSearchFilter(),
                confService.getUsernameAttributes(),
                username);
        // Build list of all DNs for retrieved users
        List<String> userDNs = new ArrayList<>(results.size());
        results.forEach(entry -> userDNs.add(entry.getDN()));
        return userDNs;
